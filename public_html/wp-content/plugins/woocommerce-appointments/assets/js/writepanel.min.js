jQuery(function(S){"use strict";var M={init:function(){S("#appointments_availability, #appointments_pricing").on("change",".wc_appointment_availability_type select, .wc_appointment_availability_type input, .wc_appointment_pricing_type select",this.wc_appointments_table_grid),S("#appointments_availability, #appointments_pricing, #appointments_products").on("focus","select, input, button",this.wc_appointments_table_grid_focus),S("body").on("row_added",this.wc_appointments_row_added),S("body").on("woocommerce-product-type-change",this.wc_appointments_trigger_change_events),S("input#_virtual").on("change",this.wc_appointments_trigger_change_events),S("input#_downloadable").on("change",this.wc_appointments_trigger_change_events),S("#_wc_appointment_user_can_cancel").on("change",this.wc_appointments_user_cancel),S("#_wc_appointment_user_can_reschedule").on("change",this.wc_appointments_user_reschedule),S("#product-type").on("change",this.wc_appointments_inventory_show),S("#product-type").on("change",this.wc_appointments_addon_style),S("#product_addons_data").on("click",".wc-pao-addon-adjust-duration",this.wc_appointments_addon_adjust_duration),S("#product_addons_data").on("change","select.wc-pao-addon-type-select",this.wc_appointments_addon_type),S("#product_addons_data").on("change","select.wc-pao-addon-type-select",this.wc_appointments_addon_label),S("#_wc_appointment_qty").on("change",this.wc_appointments_qty),S("#_wc_appointment_qty_min").on("change",this.wc_appointments_qty_min),S("#_wc_appointment_qty_max").on("change",this.wc_appointments_qty_max),S("body").on("change",".appointments-datetime-select-from :input, .appointments-datetime-select-to :input",this.wc_appointments_rule_range_change),S("#_wc_appointment_has_price_label").on("change",this.wc_appointments_price_label),S("#_wc_appointment_has_pricing").on("change",this.wc_appointments_pricing),S("#_wc_appointment_staff_assignment").on("change",this.wc_appointments_staff_assignment),S("#_wc_appointment_duration_unit").on("change",this.wc_appointment_duration_unit),S("#_wc_appointment_has_restricted_days").on("change",this.wc_appointment_restricted_days),S(".add_grid_row").on("click",this.wc_appointments_table_grid_add_row),S("body").on("click",".remove_grid_row",this.wc_appointments_table_grid_remove_row),S("body").on("click",".manual_sync",this.wc_appointments_manual_sync),S("body").on("click",".oauth_redirect",this.wc_appointments_oauth_redirect),S("#appointments_staff").on("click","button.add_staff",this.wc_appointments_add_staff),S("#appointments_staff").on("click","button.remove_appointment_staff",this.wc_appointments_remove_staff),S("#appointments_products").on("click","button.add_product",this.wc_appointments_add_product),S("#appointments_products").on("click","td.remove_product",this.wc_appointments_remove_product),M.wc_appointments_trigger_change_events(),M.wc_appointments_price_show(),M.wc_appointments_inventory_show(),M.wc_appointments_addon_style(),M.wc_appointments_sortable_rows(),M.wc_appointments_pickers(),M.wc_appointments_twilio_sms(),M.wc_appointments_exporter_title_action()},wc_appointments_rule_range_change:function(){var t=S(this),e=t.val(),n=parseFloat(e.replace(/-/g,"").replace(/:/g,"."),10),a=t.attr("class"),o=t.closest(".range_from").length?"from":"to",i="from"==o?"to":"from",_=t.closest("tr").find(".range_type select").val(),s=t.closest("tr").find(".appointments-datetime-select-"+i).find('[class^="'+a+'"]'),p=s.val(),c=parseFloat(p.replace(/-/g,"").replace(/:/g,"."),10),r="from"==o?t:s,d="from"==o?n:c,m="to"==o?t:s,l="to"==o?n:c;if(c)if("custom:daterange"===_||"time:range"===_){var w=t.closest("tr").find(".from_date input"),f=w.val(),u=parseFloat(f.replace(/-/g,"")),h=t.closest("tr").find(".from_time input"),v=h.val(),g=parseFloat(v.replace(/:/g,".")),y=t.closest("tr").find(".to_date input"),b=y.val(),k=parseFloat(b.replace(/-/g,"")),x=t.closest("tr").find(".to_time input"),C=x.val(),j=parseFloat(C.replace(/:/g,".")),q="to"==o?x:h,I="to"==o?h:x,O="to"==o?y:w,F="to"==o?w:y;t.hasClass("time-picker")?"time:range"===_&&j<g?M.wc_appointments_input_animate(q,I,!0):k<=u&&j<g?M.wc_appointments_input_animate(q,I,!0):k<u?M.wc_appointments_input_animate(q,F,!0):M.wc_appointments_input_animate(q,I):t.hasClass("date-picker")&&("time:range"===_&&j<g?M.wc_appointments_input_animate(O,I,!0):k<u?M.wc_appointments_input_animate(O,F,!0):j<g&&u===k?M.wc_appointments_input_animate(O,I,!0):M.wc_appointments_input_animate(O))}else l<d?"from"==o?(m.val(e),M.wc_appointments_input_animate(t,m)):M.wc_appointments_input_animate(t,r,!0):M.wc_appointments_input_animate(t);else s.val(e),M.wc_appointments_input_animate(t,s);return!1},wc_appointments_input_animate:function(t,e,n){t.parents("tr").find("select, input").stop().css({outlineWidth:"0"}),e&&(e.stop().css({outlineWidth:"0"}),n?e.stop().css({outlineOffset:"-1px",outlineStyle:"solid",outlineColor:"red",outlineWidth:"1px"}):e.stop().css({outlineOffset:"-1px",outlineStyle:"solid",outlineColor:"black",outlineWidth:"1px"}).animate({outlineWidth:"0"},500,"linear"))},wc_appointments_pickers:function(){return S(".date-picker").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showOtherMonths:!0,changeMonth:!0,showButtonPanel:!0,showOn:"button",firstDay:wc_appointments_writepanel_js_params.firstday,buttonText:'<span class="dashicons dashicons-calendar-alt"></span>'}),S("#_wc_appointment_cal_color").wpColorPicker(),!1},wc_appointments_table_grid:function(){var t=S(this).val(),e=S(this).closest("tr"),n=S(e);return n.find(".from_date, .from_day_of_week, .from_month, .from_week, .from_time, .from").hide(),n.find(".to_date, .to_day_of_week, .to_month, .to_week, .to_time, .to, .on_date").hide(),n.find(".repeating-label").hide(),n.find(".appointments-datetime-select-to").removeClass("appointments-datetime-select-both"),n.find(".appointments-datetime-select-from").removeClass("appointments-datetime-select-both"),n.find(".rrule").hide(),"custom"===t&&n.find(".from_date, .to_date").show(),"custom:daterange"===t&&(n.find(".from_time, .to_time").show(),n.find(".from_date, .to_date").show(),n.find(".appointments-datetime-select-to").addClass("appointments-datetime-select-both"),n.find(".appointments-datetime-select-from").addClass("appointments-datetime-select-both")),"months"===t&&n.find(".from_month, .to_month").show(),"weeks"===t&&n.find(".from_week, .to_week").show(),"days"===t&&n.find(".from_day_of_week, .to_day_of_week").show(),t.match("^time")&&(n.find(".from_time, .to_time").show(),"time:range"===t&&(n.find(".from_date, .to_date").show(),n.find(".repeating-label").show(),n.find(".appointments-datetime-select-to").addClass("appointments-datetime-select-both"),n.find(".appointments-datetime-select-from").addClass("appointments-datetime-select-both"))),"duration"!==t&&"slots"!==t&&"quant"!==t||n.find(".from, .to").show(),"rrule"===t&&n.find(".rrule").show(),!1},wc_appointments_table_grid_focus:function(t){var e=S("body"),n=S(this).closest("table, tbody"),a=S(this).closest("tr");return("focus"===t.type||"focusin"===t.type||"click"===t.type&&S(this).is(":focus"))&&(S("tr",n).removeClass("current").removeClass("last_selected"),a.addClass("current").addClass("last_selected"),e.addClass("row_highlighted")),!1},wc_appointments_sortable_rows:function(){return S("#availability_rows, #pricing_rows").sortable({items:"tr",cursor:"move",axis:"y",handle:".sort",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:{element:function(){return S('<tr class="wc-metabox-sortable-placeholder"><td colspan=99>&nbsp;</td></tr>')[0]},update:function(){}},start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),e.item.show()}}),S(".woocommerce_appointable_staff").sortable({items:".woocommerce_appointment_staff",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),M.staff_row_indexes()}}),!1},wc_appointments_row_added:function(){return S(".wc_appointment_availability_type select, .wc_appointment_pricing_type select").change(),S(".date-picker").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showOtherMonths:!0,changeMonth:!0,showButtonPanel:!0,showOn:"button",firstDay:wc_appointments_writepanel_js_params.firstday,buttonText:'<span class="dashicons dashicons-calendar-alt"></span>'}),!1},wc_appointments_trigger_change_events:function(){return S(".wc_appointment_availability_type select, .wc_appointment_availability_type input, .wc_appointment_pricing_type select, #_wc_appointment_user_can_cancel, #_wc_appointment_user_can_reschedule, #_wc_appointment_has_price_label, #_wc_appointment_has_pricing, #_wc_appointment_duration_unit, #_wc_appointment_staff_assignment, #_stock, #_wc_appointment_qty, #_wc_appointment_qty_min, #_wc_appointment_qty_max, #_wc_appointment_has_restricted_days").change(),!1},wc_appointments_user_cancel:function(){return S(this).is(":checked")?S(".form-field.appointment-cancel-limit").show():S(".form-field.appointment-cancel-limit").hide(),!1},wc_appointments_user_reschedule:function(){return S(this).is(":checked")?S(".form-field.appointment-reschedule-limit").show():S(".form-field.appointment-reschedule-limit").hide(),!1},wc_appointments_qty:function(){var t=parseInt(S(this).val(),10),e=parseInt(S("#_wc_appointment_qty_min").val(),10),n=parseInt(S("#_wc_appointment_qty_max").val(),10);return 1<t?(S(".form-field._wc_appointment_customer_qty_wrap").show(),S("#_wc_appointment_qty_min").prop("max",t),S("#_wc_appointment_qty_max").prop("max",t)):S(".form-field._wc_appointment_customer_qty_wrap").hide(),t<e&&S("#_wc_appointment_qty_min").val(t),t<n&&S("#_wc_appointment_qty_max").val(t),!1},wc_appointments_qty_min:function(){var t=parseInt(S(this).val(),10);return parseInt(S("#_wc_appointment_qty_max").val(),10)<t&&S("#_wc_appointment_qty_max").val(t),!1},wc_appointments_qty_max:function(){var t=parseInt(S(this).val(),10);return t<parseInt(S("#_wc_appointment_qty_min").val(),10)&&S("#_wc_appointment_qty_min").val(t),!1},wc_appointments_price_show:function(){return"appointment"===S("select#product-type").val()&&(S(".options_group.pricing").show(),S(".options_group.wcpbc_pricing").show()),S(".options_group.pricing").addClass("show_if_appointment"),S(".options_group.wcpbc_pricing").addClass("show_if_appointment"),!1},wc_appointments_inventory_show:function(){return"appointment"===S("select#product-type").val()&&(S(".stock_fields").hide(),S(".stock_fields").addClass("hide_if_appointment"),S("._stock_status_field").hide(),S("._stock_status_field").addClass("hide_if_appointment")),!1},wc_appointments_addon_style:function(){var t=S("select#product-type").val();return"appointment"!==t&&void 0!==t?S("body").find(".wc-pao-addon-content-option-rows").removeClass("style_if_appointment"):S("body").find(".wc-pao-addon-content-option-rows").addClass("style_if_appointment"),!1},wc_appointments_twilio_sms:function(){return S(".wc_twilio_sms_enable").each(function(){var t=S(this).data("notification");S(this).on("change",function(){S(this).is(":checked")?(S("input#wc_twilio_sms_appointments_"+t+"_recipients").closest("tr").show(),S("input#wc_twilio_sms_appointments_"+t+"_schedule_number").closest("tr").show(),S("textarea#wc_twilio_sms_appointments_"+t+"_template").closest("tr").show()):(S("input#wc_twilio_sms_appointments_"+t+"_recipients").closest("tr").hide(),S("input#wc_twilio_sms_appointments_"+t+"_schedule_number").closest("tr").hide(),S("textarea#wc_twilio_sms_appointments_"+t+"_template").closest("tr").hide())}).change()}),S("#wc-twilio-sms-appointments-data .wc-metaboxes-wrapper").on("click",".expand_all",function(){return S(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .wc-metabox-content").show(),!1}).on("click",".close_all",function(){return S(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .wc-metabox-content").hide(),!1}),S(".wc_twilio_sms_notification_toggle").each(function(){var t=S(this).data("notification"),e=S("input#wc_twilio_sms_appointments_"+t+"_schedule_number");S(this).on("change",function(){"override"===S(this).find("option:selected").val()?(e.closest("p").show(),e.closest("p").next(".wc-twilio-sms-post-field").show(),S("textarea#wc_twilio_sms_appointments_"+t+"_template").closest("p").show()):(e.closest("p").hide(),e.closest("p").next(".wc-twilio-sms-post-field").hide(),S("textarea#wc_twilio_sms_appointments_"+t+"_template").closest("p").hide())}).change()}),!1},wc_appointments_addon_adjust_duration:function(){S(this).is(":checked")?S(this).parents(".wc-pao-addon-adjust-duration-container").find(".wc-pao-addon-adjust-duration-settings").removeClass("hide").addClass("show"):S(this).parents(".wc-pao-addon-adjust-duration-container").find(".wc-pao-addon-adjust-duration-settings").removeClass("show").addClass("hide")},wc_appointments_addon_type:function(){var t=S(this).val(),e=S(this).parents(".wc-pao-addon");switch(t){case"multiple_choice":case"checkbox":e.find(".wc-pao-addon-hide_duration-setting").removeClass("hide").addClass("show"),e.find(".wc-pao-addon-hide_price-setting").removeClass("hide").addClass("show"),e.find(".wc-pao-addon-adjust-duration-container").removeClass("show").addClass("hide");break;case"heading":case"custom_price":e.find(".wc-pao-addon-adjust-duration-container").removeClass("show").addClass("hide");break;default:e.find(".wc-pao-addon-hide_duration-setting").removeClass("show").addClass("hide"),e.find(".wc-pao-addon-hide_price-setting").removeClass("show").addClass("hide"),e.find(".wc-pao-addon-adjust-duration-container").removeClass("hide").addClass("show")}return!1},wc_appointments_addon_label:function(){var t=S("select#product-type").val(),e=void 0!==t;return"appointment"!==t&&e?(S("body").find(".wc-pao-addon-content-option-rows").removeClass("style_if_appointment"),S("body").find(".wc-pao-addon-content-non-option-rows").removeClass("style_if_appointment")):(S("body").find(".wc-pao-addon-content-option-rows").addClass("style_if_appointment"),S("body").find(".wc-pao-addon-content-non-option-rows").addClass("style_if_appointment")),"appointment"!==t&&e?S(".show_if_appointment").hide():S(".show_if_appointment").show(),!1},wc_appointments_price_label:function(){return S(this).is(":checked")?S(".form-field._wc_appointment_price_label_field").show():S(".form-field._wc_appointment_price_label_field").hide(),!1},wc_appointments_pricing:function(){return S(this).is(":checked")?S("#appointments_pricing").show():S("#appointments_pricing").hide(),!1},wc_appointments_staff_assignment:function(){return"customer"===S(this).val()?(S(".form-field._wc_appointment_staff_label_field").show(),S(".form-field._wc_appointment_staff_nopref_field").show()):(S(".form-field._wc_appointment_staff_label_field").hide(),S(".form-field._wc_appointment_staff_nopref_field").hide()),!1},wc_appointment_duration_unit:function(){switch(S(this).val()){case"month":S(".form-field._wc_appointment_interval_duration_wrap").hide(),S(".form-field._wc_appointment_padding_duration_wrap").hide(),S(".form-field._wc_appointment_customer_timezones_field").hide();break;case"day":S(".form-field._wc_appointment_interval_duration_wrap").hide(),S(".form-field._wc_appointment_padding_duration_wrap").show(),S(".form-field._wc_appointment_customer_timezones_field").hide(),S('#_wc_appointment_padding_duration_unit option[value="minute"]').hide(),S('#_wc_appointment_padding_duration_unit option[value="hour"]').hide(),S('#_wc_appointment_padding_duration_unit option[value="day"]').show(),S("#_wc_appointment_padding_duration_unit").val("day");break;default:S(".form-field._wc_appointment_interval_duration_wrap").show(),S(".form-field._wc_appointment_padding_duration_wrap").show(),S(".form-field._wc_appointment_customer_timezones_field").show(),S('#_wc_appointment_padding_duration_unit option[value="minute"]').show(),S('#_wc_appointment_padding_duration_unit option[value="hour"]').show(),S('#_wc_appointment_padding_duration_unit option[value="day"]').hide()}return!1},wc_appointment_restricted_days:function(){return S(this).is(":checked")?S(".appointment-day-restriction").show():S(".appointment-day-restriction").hide(),!1},wc_appointments_table_grid_add_row:function(t){var e=S(t.target).closest("table").find("#pricing_rows tr").length,n=S(this).data("row");return n=(n=(n=(n=(n=(n=(n=n.replace(/appointments_cost_js_index_replace/gi,e.toString())).replace(/wc_appointment_availability_id.+/,'wc_appointment_availability_id[]" value="" />')).replace(/wc_appointment_availability_kind_id.+/,'wc_appointment_availability_kind_id[]" value="" />')).replace(/wc_appointment_availability_event_id.+/,'wc_appointment_availability_event_id[]" value="" />')).replace(/data-id=.+/,'data-id="">')).replace(/wc_appointment_availability_title.+/,'wc_appointment_availability_title[]" value="" />')).replace(/wc_appointment_availability_priority.+/,'wc_appointment_availability_priority[]" value="10" placeholder="10" />'),S(t.target).closest("table").find("tbody").append(n),S("body").trigger("row_added"),!1},wc_appointments_table_grid_remove_row:function(t){var e=S(t.target).closest("tr"),n=e.data("id"),a=S(".wc-appointment-availability-deleted").val(),o=a+(a?", ":"")+n;return S(".wc-appointment-availability-deleted").val(o),e.remove(),!1},wc_appointments_manual_sync:function(){var e=S(this).closest("td"),t=S(this).attr("data-staff");S(e).block({message:null});var n={action:"woocommerce_manual_sync",staff_id:t,security:wc_appointments_writepanel_js_params.nonce_manual_sync};S.post(wc_appointments_writepanel_js_params.ajax_url,n,function(t){t.error?alert(t.error):S(".last_synced").html(t.html),S(e).unblock()})},wc_appointments_oauth_redirect:function(){var e=S(this).closest("td"),t=S(this).attr("data-staff"),n=S(this).attr("data-logout");S(e).block({message:null});var a={action:"woocommerce_oauth_redirect",staff_id:t,logout:n,security:wc_appointments_writepanel_js_params.nonce_oauth_redirect};S.post(wc_appointments_writepanel_js_params.ajax_url,a,function(t){t.error?alert(t.error):top.location.replace(t.uri),S(e).unblock()})},wc_appointments_add_staff:function(){var t=S(".woocommerce_appointment_staff").length,e=parseInt(S("select#add_staff_id").val(),10);S(".woocommerce_appointable_staff").block({message:null});var n={action:"woocommerce_add_appointable_staff",post_id:wc_appointments_writepanel_js_params.post,loop:t,add_staff_id:e,add_staff_name:"",security:wc_appointments_writepanel_js_params.nonce_add_staff};return S.post(wc_appointments_writepanel_js_params.ajax_url,n,function(t){t.error?(alert(t.error),S(".woocommerce_appointable_staff").unblock()):(S(".woocommerce_appointable_staff").append(t.html).unblock(),S(".woocommerce_appointable_staff").sortable("refresh"))}),!1},wc_appointments_remove_staff:function(t){if(t.preventDefault(),confirm(wc_appointments_writepanel_js_params.i18n_confirmation)){var e=S(this).parent().parent(),n=S(this).attr("rel");S(e).block({message:null});var a={action:"woocommerce_remove_appointable_staff",post_id:wc_appointments_writepanel_js_params.post,staff_id:n,security:wc_appointments_writepanel_js_params.nonce_delete_staff};S.post(wc_appointments_writepanel_js_params.ajax_url,a,function(){S(e).fadeOut("300",function(){S(e).remove()})})}return!1},wc_appointments_add_product:function(){var e=parseInt(S("select#add_product_id").val(),10),t=parseInt(S("select#add_product_id").attr("data-staff")),n=S("#wc_appointments_staff_product_ids").val();S(".woocommerce_staff_products").block({message:null});var a={action:"woocommerce_add_staff_product",staff_id:t,assigned_products:n,add_product_id:e,add_product_name:"",security:wc_appointments_writepanel_js_params.nonce_add_product};return S.post(wc_appointments_writepanel_js_params.ajax_url,a,function(t){t.error?(alert(t.error),S(".woocommerce_staff_products").unblock()):(S(".woocommerce_staff_products").append(t.html).unblock(),S("#wc_appointments_staff_product_ids").val(n+","+e))}),!1},wc_appointments_remove_product:function(t){if(t.preventDefault(),confirm(wc_appointments_writepanel_js_params.i18n_confirmation)){var e=S(this).parent(),n=S(this).attr("data-product"),a=S(this).attr("data-staff"),o=S("#wc_appointments_staff_product_ids").val().replace(new RegExp(",?"+n+",?"),function(t){var e=","===t.charAt(0),n=","===t.charAt(t.length-1);return e&&n?",":""});S("#wc_appointments_staff_product_ids").val(o),S(e).block({message:null});var i={action:"woocommerce_remove_appointable_staff",post_id:n,staff_id:a,security:wc_appointments_writepanel_js_params.nonce_delete_staff};S.post(wc_appointments_writepanel_js_params.ajax_url,i,function(){S(e).fadeOut("300",function(){S(e).remove()})})}return!1},staff_row_indexes:function(){return S(".woocommerce_appointable_staff .woocommerce_appointment_staff").each(function(t,e){S(".staff_menu_order",e).val(parseInt(S(e).index(".woocommerce_appointable_staff .woocommerce_appointment_staff"),10))}),!1},wc_appointments_exporter_title_action:function(){var t=S(".edit-php.post-type-wc_appointment"),e=t.find(".page-title-action:first");0===t.find(".woocommerce-BlankState").length?wc_appointments_writepanel_js_params.exporter.permission&&e.after('<a href="'+wc_appointments_writepanel_js_params.exporter.url+'" class="page-title-action">'+wc_appointments_writepanel_js_params.exporter.string+"</a>"):e.hide()}};M.init()});