jQuery(function(_){"use strict";var f={init:function(){var t=_(".wc-appointments-appointment-form");t.each(function(){var t=_(this).closest("form"),s=t.find(".picker:eq(0)");t.on("addon-duration-changed",function(t,e){var i=parseInt(s.attr("data-appointment_duration"),10),a=parseInt(e,10),n=parseInt(i+a,10);s.data("combined_duration",n),s.data("addon_duration",e),f.show_available_time_slots(this)}),f.time_picker_init(t)}),_("body").on("change","#wc_appointments_field_timezone",function(){f.show_available_time_slots(this)}),t.parents("form").on("date-selected",function(){f.show_available_time_slots(this)}),_("body").on("change","#wc_appointments_field_staff",function(){f.hide_time_slots(this)})},time_picker_init:function(i){i.find(".slot-picker").on("click","a",function(t){t.preventDefault();var e=_(this).parent().data("slot");f.set_selected_time(i,e)})},set_selected_time:function(t,e){var i=t.find(".wc-appointments-appointment-form-button"),a=t.find(".slot-picker");if(i.prop("disabled",!0),undefined!==e){var n=a.find('[data-slot="'+e+'"]'),s=n.find("a").data("value");if(undefined!==n.data("slot")){var d=t.find(".slot-picker").parent("div").find("input");return d.val(s),d.attr("data-value",e),t.triggerHandler("time-selected"),a.find("li").removeClass("selected"),n.addClass("selected"),"selected"}}},unset_selected_time:function(t){var e=t.find(".wc-appointments-appointment-form-button"),i=t.find(".slot-picker");e.prop("disabled",!0),i.find("li").removeClass("selected")},show_available_time_slots:function(t){var a=_(t).closest("form"),e=a.find(".picker:eq(0)"),n=a.find(".slot-picker"),i=a.find("fieldset"),s=parseInt(i.find("input.appointment_date_year").val(),10),d=parseInt(i.find("input.appointment_date_month").val(),10),o=parseInt(i.find("input.appointment_date_day").val(),10),l=n.find(".selected").data("slot"),r=e.attr("data-is_autoselect"),c=e.data("addon_duration")?e.data("addon_duration"):0,p=0;"wc_appointments_field_timezone"===_(t).attr("name")&&(p=1),s&&d&&o&&(n.closest("div").find("input").val("").change(),n.closest("div").block({message:null,overlayCSS:{background:"#fff",backgroundSize:"16px 16px",opacity:.6}}).show(),_.ajax({type:"POST",url:wc_appointment_form_params.ajax_url,data:{action:"wc_appointments_get_slots",form:a.serialize(),duration:c},success:function(t){if(n.html(t),n.closest("div").unblock(),p)f.unset_selected_time(a);else{var e=f.set_selected_time(a,l);if(null!==wca_get_querystring("time")&&undefined===e){var i=n.find('li.slot[data-slot="'+wca_get_querystring("time")+'"]').not(".slot_empty");0<i.length?(a.triggerHandler("selected-time-unavailable",i),i.find("a").click()):f.autoselect_first_available_time(a)}else r&&undefined===e&&f.autoselect_first_available_time(a)}},dataType:"html"}))},autoselect_first_available_time:function(t){var e=t.find(".picker:eq(0)"),i=t.find(".slot-picker"),a=e.find("td.ui-datepicker-current-day").not(".ui-state-disabled"),n=i.find('li.slot:not(".slot_empty"):first'),s=e.attr("data-is_autoselect");if(console.log("3"),0<n.length&&n.has("a")){var d=n.data("slot");f.set_selected_time(t,d)}else s&&a.nextAll("td:not(.ui-state-disabled)").add(a.closest("tr").nextAll().find("td")).slice(0,1).click()},hide_time_slots:function(t){var e=_(t).closest("form"),i=e.find(".slot-picker"),a=e.find("fieldset"),n=parseInt(a.find("input.appointment_date_year").val(),10),s=parseInt(a.find("input.appointment_date_month").val(),10),d=parseInt(a.find("input.appointment_date_day").val(),10);n&&s&&d&&i.hide()}};f.init()});